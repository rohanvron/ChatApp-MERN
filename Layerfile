# Use the Node.js image from webapp.io
FROM webapp.io/node

# Set the working directory to /app
WORKDIR /app

# Copy the whole project to the container
COPY . .

# Install backend dependencies
RUN npm install

# Install frontend dependencies and build the frontend
RUN npm install --prefix frontend
RUN npm run build --prefix frontend

# Move the frontend build files to the backend's public directory
RUN mkdir -p backend/public
RUN cp -r frontend/dist/* backend/public/

# Expose the port the app runs on
EXPOSE 5000

# Start the backend server
CMD ["node", "backend/server.js"]
