FROM vm/ubuntu:22.04

# Install Node.js
RUN curl -sL https://deb.nodesource.com/setup_18.x | sudo -E bash -
RUN sudo apt-get install -y nodejs

# Install MongoDB
RUN sudo apt-get update
RUN sudo apt-get install -y mongodb
RUN sudo systemctl start mongodb

# Clone your repository
COPY . .

# Install dependencies
RUN npm install
RUN cd frontend && npm install

# Build the frontend
RUN cd frontend && npm run build

# Move the frontend build to the backend public directory
RUN mkdir -p backend/public
RUN cp -r frontend/dist/* backend/public/

# Start the server
RUN BACKGROUND node backend/server.js
EXPOSE WEBSITE http://localhost:5000